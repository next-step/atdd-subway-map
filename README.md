# 지하철 노선도 미션

[ATDD 강의](https://edu.nextstep.camp/c/R89PYi5H) 실습을 위한 지하철 노선도 애플리케이션

# ERD

![img.png](erd.png)

- 구간 N : 역 1
    - 구간은 역을 반드시 가져야 한다
    - 역은 구간을 가질수도 있고 안 가질 수 도 있다
- 노선 1 : 구간 N
    - 노선은 구간을 반드시 가져야 한다
    - 구간은 노선을 반드시 가져야 한다

# 요구사항 & 구현

## 노선

- 생성
    - 입력값 : 상행역 아이디, 하행역 아이디, 노선정보
    - 결과 : 노선저장 -> 구간저장
- 단건조회
    - 노선 아이디로 노선 테이블 조회 -> 지연로딩으로 구간 조회 -> 구간의 노선역 생성메서드 호출 -> 노선응답객체 생성
- 목록조회
- 수정
- 삭제
    - 구간은 노선이 삭제 되면 같이 삭제 되야 한다 (고아 객체 사용)

## 구간

### 등록

- 지하철 노선에 구간을 등록하는 기능을 구현
    - 입력 : 노선아이디, 상행역아이디, 하행역아이디, 거리
    - 결과 : 구간 등록
- 1)새로운 구간의 상행역은 해당 노선에 등록되어있는 하행 종점역이어야 한다.
    - 노선 아이디로 가장 마지막 구간 조회후 하행역 아이디가 같은지 확인
- 2)새로운 구간의 하행역은 해당 노선에 등록되어있는 역일 수 없다.
    - 1)에서 마지막 하행역이 같은지 체크했으므로 역아이디로 노선에서 상행역을 찾아 체크
- 새로운 구간 등록시 위 조건에 부합하지 않는 경우 에러 처리한다.

### 제거

- 지하철 노선에 구간을 제거하는 기능 구현
- 1)지하철 노선에 상행 종점역과 하행 종점역만 있는 경우(구간이 1개인 경우) 역을 삭제할 수 없다.
    - 노선아이디로 노선 엔티티 조회후 연관관계 구간의 수를 체크
- 2)지하철 노선에 등록된 역(하행 종점역)만 제거할 수 있다. 즉, 마지막 구간만 제거할 수 있다.
    - 노선아이디로 노선 엔티티 조회후 마지막 구간의 하행역의 id가 같은지 체크후 같으면 List에서 제거 (고아 객체)
- 새로운 구간 제거시 위 조건에 부합하지 않는 경우 에러 처리한다.